# GEMINI.md

> Google Gemini 专用指令文件 - 知识图谱驱动的智能辅助

## 🎯 核心原则：复用优先，乐高式组合

作为 Google Gemini，你在协助开发时必须遵循**乐高式复用哲学**：

### 🎭 复用优先（最高优先级）

```
任何开发任务前：
AI → 检查可复用资源 → 评估复用性 → 复用或组合 → 更新文档

检查优先级：
1. UI 组件 (docs/components/组件索引.md)
2. 数据结构 (docs/.meta/code-index.json)
3. 业务逻辑 (src/domain/, src/lib/)
4. 配置数据 (public/data/, src/config/)
5. 设计模式 (docs/design/)
```

### 🧩 乐高式组合哲学

> **核心**: "凡是通用性都该复用，凡是特有则在此基础上组合"

#### 通用性特征（应该复用）

```typescript
const GENERIC_TRAITS = {
  ui: [
    '跨场景可用的交互模式',     // SortButtonGroup, Button, Input
    '标准化的视觉样式',         // 统一的颜色、字体、间距
    '常见的数据展示形式',       // 表格、图表、卡片
    '重复的用户操作流程',       // 搜索、筛选、排序
  ],
  logic: [
    '纯函数计算逻辑',            // calculateAchievementRate, formatCurrency
    '数据转换工具',              // 排序、过滤、聚合
    '验证规则',                  // Zod schemas
    '格式化工具',                // 日期、货币、百分比
  ],
  data: [
    '跨业务实体的属性',          // 机构、产品、时间类型
    '通用的枚举值',              // 产品类型、组织模式
    '标准化的数据结构',          // 统一的API接口格式
  ],
};
```

#### 特有性特征（需要组合）

```typescript
const SPECIFIC_TRAITS = {
  business: [
    '特定业务规则',              // 四川分公司的特殊权重
    '特殊计算公式',              // 特定增长率计算
    '业务特定的流程',            // 三级机构的特殊筛选
  ],
  ui: [
    '特定的页面布局',            // 特定页面的组件编排
    '特殊的交互组合',            // 业务特定的交互流程
    '业务特定的组件编排',        // 页面级别的组合
  ],
};
```

### ✅ 必须复用的内容（乐高积木块）

#### 原子级组件

```yaml
UI 组件:
  - SortButtonGroup    # 排序按钮组（任何列表/图表排序）
  - Button             # 通用按钮
  - Input              # 输入框
  - Select             # 下拉选择
  - Modal              # 模态框
  - Badge              # 徽章
  - Tooltip            # 提示框

业务逻辑:
  - calculateAchievementRate  # 达成率计算
  - calculateGrowthRate       # 增长率计算
  - formatCurrency           # 货币格式化
  - sortOrgItems              # 机构排序工具

数据结构:
  - OrgSchema          # 机构结构
  - Product type       # 产品类型
  - TimeGranularity    # 时间粒度
```

#### 复合级组件

```yaml
数据展示:
  - UniversalChart     # 通用图表（高度可配置）
  - DataTable          # 数据表格
  - KpiCard           # KPI卡片

交互组件:
  - FilterSelector    # 筛选选择器
  - SearchBar         # 搜索栏
  - Pagination        # 分页器
```

### ❌ 不应该复用的内容（需要组合）

```yaml
业务特定:
  - 特定计算公式   # 如：四川分公司特殊权重
  - 特殊流程       # 如：三级机构特殊筛选
  - 特殊聚合逻辑   # 如：特定的数据组合方式

页面级:
  - 页面布局       # 特定页面的组件编排
  - 数据流         # 业务特定的数据流
  - 状态管理       # 页面级别的状态
```

### 🔍 复用决策矩阵

```yaml
完全复用 (匹配度 ≥ 90%):
  动作: 直接使用
  示例: SortButtonGroup 用于任何排序场景

部分复用 (70% ≤ 匹配度 < 90%):
  动作: 扩展现有组件
  示例: UniversalChart 配置为新图表类型

组合构建 (匹配度 < 70%):
  动作: 组合原子组件
  示例: OrgDetailClient = SortButtonGroup + UniversalChart + 业务逻辑
```

### 💡 判断技巧

```
问题1: 是否通用？
  - 去掉业务术语，还能理解？ → 是（通用）
  - 能用于其他项目？         → 是（通用）
  - 不依赖特定业务概念？     → 是（通用）

问题2: 应该复用还是新建？
  - 复用成本 < 新建成本 → 复用
  - 复用成本 ≥ 新建成本 → 组合

问题3: 如何组合？
  - 原子层: Button, Input
  - 分子层: SearchBar = Input + Button
  - 聚合层: PageHeader = Title + ActionBar
  - 页面层: Dashboard = 所有层的组合
```

### 📊 Gemini 专属能力在复用中的应用

#### 能力1: 多模态理解
- 查看组件设计图，识别可复用模式
- 理解组件关系图，找到组合机会
- 对比不同场景的UI，提取通用元素

#### 能力2: 大规模推理
- 分析整个组件库，找到最匹配的组件
- 识别组件间的相似性和差异性
- 预测组件扩展的可行性

#### 能力3: 影响分析
- 评估复用对现有代码的影响
- 预测组合组件的维护成本
- 识别潜在的冲突和依赖

---

## 🎯 核心原则：索引优先，图谱导航

作为 Google Gemini，你在协助开发时必须：
1. **先查询知识图谱**：理解项目结构和概念关系
2. **追溯文档源头**：代码的业务逻辑定义在哪里
3. **评估影响范围**：修改会影响哪些模块
4. **同步更新所有关联**：文档、代码、索引、测试

## 🗺️ 知识图谱系统

### 索引文件位置
```
docs/.meta/
├── docs-index.json      # 文档索引（AI可直接读取）
├── code-index.json      # 代码索引（AI可直接读取）
├── graph.json           # 知识图谱（节点+边）
└── ai-context.md        # AI工具使用指南
```

### Gemini 专属能力

作为 Google Gemini，你擅长：
- ✅ **多模态理解**：可以理解图表、架构图、流程图
- ✅ **大规模推理**：可以一次性分析整个知识图谱
- ✅ **代码与文档对比**：找出不一致之处
- ✅ **影响分析**：预测修改的连锁反应

## 📚 项目概览（基于索引）

**四川分公司车险目标管理平台（2025-2026）**

核心功能：
- 年度目标分配到月度/季度
- 实际数据录入与达成率计算
- 时间进度达成率（三种口径）
- 同比增长指标
- 大屏展示优化

### 关键模块映射

| 业务概念 | 文档位置 | 代码实现 |
|---------|---------|---------|
| 时间进度 | docs/business/指标定义规范.md:26-64 | src/domain/time.ts |
| 达成率 | docs/business/指标定义规范.md:22-24 | src/domain/achievement.ts |
| 增长率 | docs/business/指标定义规范.md:66-92 | src/domain/growth.ts |

## 🔍 Gemini 智能查询工作流

### 场景1: 理解新概念
```
用户问："什么是时间进度达成率？"

你的步骤：
1. 查询 docs-index.json 搜索 "时间进度"
2. 找到文档位置
3. 阅读业务定义
4. 查询代码实现
5. 生成完整答案
```

### 场景2: 代码审查
```
用户提交PR修改 src/domain/time.ts

你的审查：
1. 读取 code-index 找关联文档
2. 检查文档是否同步更新
3. 查看依赖关系
4. 生成审查报告
```

### 场景3: 影响分析
```
用户想修改某个函数

你的分析：
1. 读取 graph.json
2. 找出所有依赖
3. 评估风险级别
4. 提供修改建议
```

## 🎨 Gemini 专属技能

### 技能1: 多模态分析
- 解析架构图
- 理解流程图
- 对比设计与代码

### 技能2: 大规模推理
- 分析整个知识图谱
- 识别模式和异常
- 生成健康度报告

### 技能3: 智能推荐
- 基于上下文推荐相关内容
- 提供最佳实践建议
- 预测可能的问题

### 技能4: 影响分析
- 修改前的风险评估
- 依赖链分析
- 连锁反应预测

## 📊 质量检查清单

每次协助开发时确认：
- [ ] 文档定义与代码实现一致
- [ ] 索引文件完整
- [ ] 所有依赖已更新
- [ ] TypeScript 类型正确
- [ ] JSDoc 注释完整

## 📚 必读文档
1. docs/.meta/ai-context.md - 完整指南
2. docs/architecture/文档代码索引系统设计.md - 系统设计
3. docs/.meta/QUICKSTART.md - 快速入门

---

**Gemini，你是知识图谱的守护者！** 🌟
