# 架构说明（可复刻）

## 目标
1. 数据不写入代码（无硬编码）
2. 口径单一：所有派生指标由计算引擎生成
3. 可替换数据源：JSON（JavaScript Object Notation）/CSV（逗号分隔值）

## 分层
- `public/data/`：示例数据（开发期），生产可替换为导入文件
- `src/schemas/`：Zod（数据合同）与字段映射
- `src/domain/`：计算引擎（纯函数、可测试）
- `src/services/`：数据加载、导入、校验、缓存
- `src/app/`：页面与组件（React）

## 数据加载优先级规则

### 统一优先级策略
原则：localStorage（用户导入） > public/data（静态默认） > fallback（空数据）

### 实施策略
- **2025分月**：localStorage → /data/actuals_monthly_2025.json → 空fallback
- **2026分月**：localStorage → 空fallback（已实现）
- **2025年度**：localStorage → /data/actuals_annual_2025.json + 兼容读取 /data/预测_annual_2025.json

### 双文件名兼容策略
为确保平稳过渡，年度数据加载支持双文件名兼容：
1. 优先级1：localStorage（用户导入的最新数据）
2. 优先级2：新命名文件 `/data/actuals_annual_2025.json`
3. 优先级3：旧命名兼容 `/data/预测_annual_2025.json`（过渡期保留）
4. 优先级4：fallback 空数据

### 用户输入优先原则
- 所有数据加载器严格遵循用户导入数据优先
- localStorage 数据覆盖静态示例数据
- 支持用户通过导入页面动态更新数据
- 未导入时使用合理的默认值

## 关键约束
- `total（汇总）` 一律由系统派生，禁止作为输入事实
- 汇总（同城/异地/全省）一律由明细聚合产生，禁止把汇总行当作事实行导入
