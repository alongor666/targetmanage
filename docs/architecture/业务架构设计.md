# ğŸ’¼ ä¸šåŠ¡æ¶æ„è®¾è®¡

> å·åˆ†ç›®æ ‡ç®¡ç†ç³»ç»Ÿçš„ä¸šåŠ¡é€»è¾‘æ¶æ„ä¸é¢†åŸŸæ¨¡å‹  
**ç‰ˆæœ¬:** 2.0.0  
**æ›´æ–°æ—¶é—´:** 2025-12-23  
**ä¸šåŠ¡é¢†åŸŸ**: è½¦é™©ç»è¥ç›®æ ‡ç®¡ç†

---

## ğŸ“‘ ä¸šåŠ¡æ¦‚è§ˆ

- [é¢†åŸŸæ¨¡å‹](#-é¢†åŸŸæ¨¡å‹)
- [ä¸šåŠ¡æµç¨‹](#-ä¸šåŠ¡æµç¨‹)
- [æ•°æ®æ¨¡å‹](#-æ•°æ®æ¨¡å‹)
- [æœåŠ¡æ¶æ„](#-æœåŠ¡æ¶æ„)
- [ä¸šåŠ¡è§„åˆ™](#-ä¸šåŠ¡è§„åˆ™)

---

## ğŸ¢ é¢†åŸŸæ¨¡å‹

### ğŸ“Š æ ¸å¿ƒä¸šåŠ¡é¢†åŸŸ

```mermaid
graph TB
    A[è½¦é™©ç»è¥ç®¡ç†] --> B[ç›®æ ‡ç®¡ç†]
    A --> C[ç»©æ•ˆåˆ†æ]
    A --> D[æ•°æ®å¯è§†åŒ–]
    
    B --> E[å¹´åº¦ç›®æ ‡]
    B --> F[å­£åº¦ç›®æ ‡]
    B --> G[æœˆåº¦ç›®æ ‡]
    
    C --> H[è¾¾æˆåˆ†æ]
    C --> I[è¶‹åŠ¿åˆ†æ]
    C --> J[å¯¹æ¯”åˆ†æ]
    
    D --> K[KPIå±•ç¤º]
    D --> L[å›¾è¡¨åˆ†æ]
    D --> M[æŠ¥è¡¨ç”Ÿæˆ]
    
    E --> N[æœºæ„ç›®æ ‡]
    E --> O[äº§å“ç›®æ ‡]
    E --> P[æ¸ é“ç›®æ ‡]
```

### ğŸ¯ ä¸šåŠ¡å®ä½“æ¨¡å‹

```typescript
// æ ¸å¿ƒä¸šåŠ¡å®ä½“
interface BusinessDomain {
  // æœºæ„å®ä½“
  Organization: {
    id: string;
    code: string;
    name: string;
    level: 'province' | 'city' | 'branch';
    parentId?: string;
    children?: Organization[];
  };
  
  // äº§å“å®ä½“
  Product: {
    id: string;
    code: string;
    name: string;
    category: 'auto' | 'property' | 'accident' | 'other';
    subCategory?: string;
  };
  
  // ç›®æ ‡å®ä½“
  Target: {
    id: string;
    organizationId: string;
    productId: string;
    year: number;
    quarter?: number;
    month?: number;
    type: 'premium' | 'policy' | 'profit';
    value: number;
    unit: 'yuan' | 'count' | 'rate';
    status: 'draft' | 'approved' | 'active' | 'completed';
  };
  
  // ä¸šç»©å®ä½“
  Achievement: {
    id: string;
    targetId: string;
    organizationId: string;
    productId: string;
    period: string; // YYYY-MMæ ¼å¼
    actualValue: number;
    plannedValue: number;
    achievementRate: number;
    status: 'preliminary' | 'final' | 'adjusted';
  };
}
```

### ğŸ“Š ä¸šåŠ¡å…³ç³»æ¨¡å‹

```typescript
// ä¸šåŠ¡å…³ç³»å®šä¹‰
interface BusinessRelationships {
  // æœºæ„å±‚çº§å…³ç³»
  organizationHierarchy: {
    type: 'tree';
    rootLevel: 'province';
    maxDepth: 3;
    aggregationRules: {
      premium: 'sum';
      policy: 'sum';
      rate: 'weighted_average';
    };
  };
  
  // æ—¶é—´ç»´åº¦å…³ç³»
  timeDimensions: {
    year: {
      quarters: [1, 2, 3, 4];
      months: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12];
    };
    aggregationRules: {
      quarterly: 'sum_of_months';
      annual: 'sum_of_quarters';
    };
  };
  
  // äº§å“ç»„åˆå…³ç³»
  productCombinations: {
    primary: ['auto', 'property'];
    secondary: ['accident', 'other'];
    bundlingRules: {
      crossSell: 'enable';
      upsell: 'enable';
      package: 'optional';
    };
  };
}
```

---

## ğŸ”„ ä¸šåŠ¡æµç¨‹

### ğŸ“Š ç›®æ ‡ç®¡ç†æµç¨‹

```mermaid
flowchart TD
    A[ç›®æ ‡åˆ¶å®š] --> B[ç›®æ ‡åˆ†è§£]
    B --> C[ç›®æ ‡å®¡æ‰¹]
    C --> D[ç›®æ ‡æ‰§è¡Œ]
    D --> E[ç›®æ ‡è·Ÿè¸ª]
    E --> F[ç›®æ ‡è¯„ä¼°]
    F --> G[ç›®æ ‡è°ƒæ•´]
    G --> D
    
    A --> A1[å¹´åº¦æ€»ç›®æ ‡è®¾å®š]
    A --> A2[æœºæ„ç›®æ ‡åˆ†é…]
    A --> A3[äº§å“ç›®æ ‡åˆ†è§£]
    
    B --> B1[å­£åº¦ç›®æ ‡åˆ†è§£]
    B --> B2[æœˆåº¦ç›®æ ‡ç»†åŒ–]
    B --> B3[æ¸ é“ç›®æ ‡åˆ†é…]
    
    C --> C1[ç®¡ç†å±‚å®¡æ‰¹]
    C --> C2[è´¢åŠ¡éƒ¨é—¨å®¡æ ¸]
    C --> C3[ä¸šåŠ¡éƒ¨é—¨ç¡®è®¤]
```

### ğŸ¯ ç»©æ•ˆåˆ†ææµç¨‹

```typescript
// ç»©æ•ˆåˆ†æä¸šåŠ¡æµç¨‹
interface PerformanceAnalysisFlow {
  // æ•°æ®æ”¶é›†é˜¶æ®µ
  dataCollection: {
    sources: [
      'core_system',      // æ ¸å¿ƒä¸šåŠ¡ç³»ç»Ÿ
      'financial_system', // è´¢åŠ¡ç³»ç»Ÿ
      'crm_system',      // å®¢æˆ·å…³ç³»ç³»ç»Ÿ
      'external_data'     // å¤–éƒ¨æ•°æ®æº
    ];
    frequency: 'daily';
    validation: 'automatic';
  };
  
  // æ•°æ®å¤„ç†é˜¶æ®µ
  dataProcessing: {
    cleansing: 'remove_duplicates_and_errors';
    transformation: 'standardize_units_and_formats';
    enrichment: 'add_calculated_fields';
    aggregation: 'summarize_by_dimensions';
  };
  
  // åˆ†æè®¡ç®—é˜¶æ®µ
  analysisCalculation: {
    basicMetrics: [
      'premium_income',
      'policy_count', 
      'profit_margin',
      'loss_ratio'
    ];
    derivedMetrics: [
      'achievement_rate',
      'growth_rate',
      'market_share',
      'efficiency_ratio'
    ];
    comparisons: [
      'period_comparison',
      'organization_comparison',
      'product_comparison'
    ];
  };
  
  // ç»“æœè¾“å‡ºé˜¶æ®µ
  resultOutput: {
    dashboards: 'real_time_visualization';
    reports: 'scheduled_generation';
    alerts: 'threshold_based_notifications';
    exports: 'multiple_formats';
  };
}
```

### ğŸ“ˆ æ•°æ®å¯è§†åŒ–æµç¨‹

```mermaid
flowchart LR
    A[æ•°æ®éœ€æ±‚] --> B[å›¾è¡¨é€‰æ‹©]
    B --> C[æ•°æ®å¤„ç†]
    C --> D[è§†è§‰è®¾è®¡]
    D --> E[äº¤äº’è®¾è®¡]
    E --> F[æ€§èƒ½ä¼˜åŒ–]
    F --> G[ç”¨æˆ·æµ‹è¯•]
    G --> H[å‘å¸ƒä¸Šçº¿]
    
    B --> B1[KPIæŒ‡æ ‡ - å¡ç‰‡å›¾]
    B --> B2[è¶‹åŠ¿åˆ†æ - æŠ˜çº¿å›¾]
    B --> B3[å¯¹æ¯”åˆ†æ - æŸ±çŠ¶å›¾]
    B --> B4[ç»“æ„åˆ†æ - é¥¼å›¾]
    B --> B5[åˆ†å¸ƒåˆ†æ - æ•£ç‚¹å›¾]
    
    C --> C1[æ•°æ®èšåˆ]
    C --> C2[æ•°æ®ç­›é€‰]
    C --> C3[æ•°æ®æ’åº]
    C --> C4[æ•°æ®æ ¼å¼åŒ–]
```

---

## ğŸ“Š æ•°æ®æ¨¡å‹

### ğŸ¯ æ ¸å¿ƒæ•°æ®æ¨¡å‹

```typescript
// ç›®æ ‡æ•°æ®æ¨¡å‹
interface TargetModel {
  // åŸºç¡€å±æ€§
  id: string;                    // å”¯ä¸€æ ‡è¯†
  name: string;                  // ç›®æ ‡åç§°
  description?: string;          // ç›®æ ‡æè¿°
  
  // å…³è”å±æ€§
  organizationId: string;        // æ‰€å±æœºæ„
  productId: string;             // æ‰€å±äº§å“
  dimensionId?: string;          // åˆ†æç»´åº¦
  
  // æ—¶é—´å±æ€§
  year: number;                  // å¹´åº¦
  quarter?: number;              // å­£åº¦
  month?: number;                // æœˆä»½
  startDate: Date;               // å¼€å§‹æ—¥æœŸ
  endDate: Date;                 // ç»“æŸæ—¥æœŸ
  
  // ç›®æ ‡å±æ€§
  type: TargetType;              // ç›®æ ‡ç±»å‹
  value: number;                 // ç›®æ ‡å€¼
  unit: TargetUnit;              // è®¡é‡å•ä½
  baselineValue?: number;        // åŸºå‡†å€¼
  stretchValue?: number;         // æŒ‘æˆ˜å€¼
  
  // çŠ¶æ€å±æ€§
  status: TargetStatus;          // ç›®æ ‡çŠ¶æ€
  priority: TargetPriority;      // ä¼˜å…ˆçº§
  category: TargetCategory;      // ç›®æ ‡ç±»åˆ«
  
  // å®¡è®¡å±æ€§
  createdBy: string;             // åˆ›å»ºäºº
  createdAt: Date;               // åˆ›å»ºæ—¶é—´
  updatedBy?: string;            // æ›´æ–°äºº
  updatedAt?: Date;               // æ›´æ–°æ—¶é—´
  approvedBy?: string;           // å®¡æ‰¹äºº
  approvedAt?: Date;             // å®¡æ‰¹æ—¶é—´
}

// ç›®æ ‡ç±»å‹æšä¸¾
enum TargetType {
  PREMIUM = 'premium',           // ä¿è´¹ç›®æ ‡
  POLICY = 'policy',             // ä¿å•ç›®æ ‡
  PROFIT = 'profit',             // åˆ©æ¶¦ç›®æ ‡
  GROWTH = 'growth',             // å¢é•¿ç›®æ ‡
  EFFICIENCY = 'efficiency'      // æ•ˆç‡ç›®æ ‡
}

// ç›®æ ‡å•ä½æšä¸¾
enum TargetUnit {
  YUAN = 'yuan',                 // å…ƒ
  TEN_THOUSAND_YUAN = 'ten_thousand_yuan',  // ä¸‡å…ƒ
  MILLION_YUAN = 'million_yuan', // ç™¾ä¸‡å…ƒ
  COUNT = 'count',               // æ•°é‡
  RATE = 'rate',                 // æ¯”ç‡
  PERCENT = 'percent'            // ç™¾åˆ†æ¯”
}
```

### ğŸ“Š ä¸šç»©æ•°æ®æ¨¡å‹

```typescript
// ä¸šç»©æ•°æ®æ¨¡å‹
interface AchievementModel {
  // åŸºç¡€å±æ€§
  id: string;                    // å”¯ä¸€æ ‡è¯†
  targetId: string;              // å…³è”ç›®æ ‡
  organizationId: string;        // æ‰€å±æœºæ„
  productId: string;             // æ‰€å±äº§å“
  
  // æ—¶é—´å±æ€§
  period: string;                // ç»Ÿè®¡å‘¨æœŸ YYYY-MM
  year: number;                  // å¹´åº¦
  quarter?: number;              // å­£åº¦
  month?: number;                // æœˆä»½
  reportDate: Date;              // æŠ¥å‘Šæ—¥æœŸ
  
  // ä¸šç»©å±æ€§
  actualValue: number;           // å®é™…å€¼
  plannedValue: number;          // è®¡åˆ’å€¼
  variance: number;               // å·®å¼‚å€¼
  achievementRate: number;        // è¾¾æˆç‡
  
  // çŠ¶æ€å±æ€§
  status: AchievementStatus;     // ä¸šç»©çŠ¶æ€
  confidence: ConfidenceLevel;   // æ•°æ®ç½®ä¿¡åº¦
  quality: DataQuality;          // æ•°æ®è´¨é‡
  
  // è¯¦ç»†åˆ†è§£
  breakdowns?: {                 // æ˜ç»†åˆ†è§£
    channel?: AchievementBreakdown;     // æ¸ é“åˆ†è§£
    product?: AchievementBreakdown;      // äº§å“åˆ†è§£
    region?: AchievementBreakdown;       // åŒºåŸŸåˆ†è§£
  };
  
  // å®¡è®¡å±æ€§
  dataSource: string;            // æ•°æ®æ¥æº
  verifiedBy?: string;           // éªŒè¯äºº
  verifiedAt?: Date;             // éªŒè¯æ—¶é—´
  comments?: string;             // å¤‡æ³¨è¯´æ˜
}

// ä¸šç»©åˆ†è§£æ•°æ®
interface AchievementBreakdown {
  dimension: string;             // ç»´åº¦åç§°
  items: Array<{
    key: string;                 // ç»´åº¦å€¼
    actualValue: number;         // å®é™…å€¼
    plannedValue: number;        // è®¡åˆ’å€¼
    achievementRate: number;    // è¾¾æˆç‡
  }>;
}
```

---

## ğŸ› ï¸ æœåŠ¡æ¶æ„

### ğŸ“Š ä¸šåŠ¡æœåŠ¡å±‚

```typescript
// ä¸šåŠ¡æœåŠ¡æ¥å£å®šä¹‰
interface BusinessServices {
  // ç›®æ ‡ç®¡ç†æœåŠ¡
  targetService: {
    // ç›®æ ‡CRUDæ“ä½œ
    createTarget(request: CreateTargetRequest): Promise<Target>;
    updateTarget(id: string, request: UpdateTargetRequest): Promise<Target>;
    deleteTarget(id: string): Promise<void>;
    getTarget(id: string): Promise<Target>;
    
    // ç›®æ ‡æŸ¥è¯¢æ“ä½œ
    listTargets(filters: TargetFilters): Promise<PaginatedResponse<Target>>;
    searchTargets(query: string): Promise<Target[]>;
    
    // ç›®æ ‡ä¸šåŠ¡æ“ä½œ
    approveTarget(id: string, request: ApproveTargetRequest): Promise<Target>;
    activateTarget(id: string): Promise<Target>;
    deactivateTarget(id: string): Promise<Target>;
    
    // ç›®æ ‡åˆ†ææ“ä½œ
    analyzeTargets(filters: AnalysisFilters): Promise<TargetAnalysis>;
    compareTargets(request: CompareTargetsRequest): Promise<TargetComparison>;
  };
  
  // ä¸šç»©ç®¡ç†æœåŠ¡
  achievementService: {
    // ä¸šç»©CRUDæ“ä½œ
    createAchievement(request: CreateAchievementRequest): Promise<Achievement>;
    updateAchievement(id: string, request: UpdateAchievementRequest): Promise<Achievement>;
    deleteAchievement(id: string): Promise<void>;
    getAchievement(id: string): Promise<Achievement>;
    
    // ä¸šç»©æŸ¥è¯¢æ“ä½œ
    listAchievements(filters: AchievementFilters): Promise<PaginatedResponse<Achievement>>;
    searchAchievements(query: string): Promise<Achievement[]>;
    
    // ä¸šç»©åˆ†ææ“ä½œ
    analyzeAchievements(filters: AnalysisFilters): Promise<AchievementAnalysis>;
    calculateAchievementRate(request: AchievementRateRequest): Promise<AchievementRate>;
    
    // ä¸šç»©æŠ¥è¡¨æ“ä½œ
    generateAchievementReport(request: ReportRequest): Promise<Report>;
    exportAchievements(request: ExportRequest): Promise<ExportResult>;
  };
  
  // åˆ†ææœåŠ¡
  analysisService: {
    // è¶‹åŠ¿åˆ†æ
    analyzeTrend(request: TrendAnalysisRequest): Promise<TrendAnalysis>;
    
    // å¯¹æ¯”åˆ†æ
    comparePerformance(request: ComparisonRequest): Promise<ComparisonResult>;
    
    // é¢„æµ‹åˆ†æ
    forecastPerformance(request: ForecastRequest): Promise<ForecastResult>;
    
    // å¼‚å¸¸æ£€æµ‹
    detectAnomalies(request: AnomalyDetectionRequest): Promise<AnomalyResult>;
  };
}
```

### ğŸ¯ é¢†åŸŸæœåŠ¡å®ç°

```typescript
// ç›®æ ‡ç®¡ç†æœåŠ¡å®ç°
class TargetService implements TargetServiceInterface {
  constructor(
    private targetRepository: TargetRepository,
    private organizationRepository: OrganizationRepository,
    private eventBus: EventBus,
    private logger: Logger
  ) {}
  
  /**
   * åˆ›å»ºç›®æ ‡
   * ä¸šåŠ¡è§„åˆ™éªŒè¯ã€æ•°æ®æ ¡éªŒã€äº‹ä»¶å‘å¸ƒ
   */
  async createTarget(request: CreateTargetRequest): Promise<Target> {
    // 1. ä¸šåŠ¡è§„åˆ™éªŒè¯
    await this.validateCreateTargetRules(request);
    
    // 2. æ•°æ®è½¬æ¢
    const target = this.mapToTarget(request);
    
    // 3. æŒä¹…åŒ–
    const createdTarget = await this.targetRepository.create(target);
    
    // 4. å‘å¸ƒäº‹ä»¶
    await this.eventBus.publish(new TargetCreatedEvent(createdTarget));
    
    // 5. è®°å½•æ—¥å¿—
    this.logger.info('Target created', { targetId: createdTarget.id });
    
    return createdTarget;
  }
  
  /**
   * ç›®æ ‡å®¡æ‰¹
   * æƒé™éªŒè¯ã€çŠ¶æ€å˜æ›´ã€é€šçŸ¥å‘é€
   */
  async approveTarget(id: string, request: ApproveTargetRequest): Promise<Target> {
    // 1. è·å–ç›®æ ‡
    const target = await this.targetRepository.findById(id);
    if (!target) {
      throw new TargetNotFoundError(id);
    }
    
    // 2. æƒé™éªŒè¯
    await this.validateApprovalPermission(request.approverId);
    
    // 3. çŠ¶æ€å˜æ›´
    target.status = TargetStatus.APPROVED;
    target.approvedBy = request.approverId;
    target.approvedAt = new Date();
    target.comments = request.comments;
    
    // 4. æŒä¹…åŒ–
    const approvedTarget = await this.targetRepository.update(target);
    
    // 5. å‘å¸ƒäº‹ä»¶
    await this.eventBus.publish(new TargetApprovedEvent(approvedTarget));
    
    // 6. å‘é€é€šçŸ¥
    await this.notificationService.sendApprovalNotification(approvedTarget);
    
    return approvedTarget;
  }
  
  /**
   * ç›®æ ‡åˆ†æ
   * æ•°æ®èšåˆã€æŒ‡æ ‡è®¡ç®—ã€ç»“æœè¿”å›
   */
  async analyzeTargets(filters: AnalysisFilters): Promise<TargetAnalysis> {
    // 1. æ•°æ®æŸ¥è¯¢
    const targets = await this.targetRepository.findByFilters(filters);
    
    // 2. æ•°æ®èšåˆ
    const aggregatedData = this.aggregateTargets(targets, filters.dimensions);
    
    // 3. æŒ‡æ ‡è®¡ç®—
    const metrics = this.calculateMetrics(aggregatedData);
    
    // 4. è¶‹åŠ¿åˆ†æ
    const trends = this.analyzeTrends(aggregatedData, filters.timeRange);
    
    // 5. æ„å»ºåˆ†æç»“æœ
    return {
      summary: this.buildSummary(metrics),
      details: aggregatedData,
      trends,
      insights: this.generateInsights(metrics, trends)
    };
  }
  
  private async validateCreateTargetRules(request: CreateTargetRequest): Promise<void> {
    // éªŒè¯æœºæ„å­˜åœ¨æ€§
    const organization = await this.organizationRepository.findById(request.organizationId);
    if (!organization) {
      throw new OrganizationNotFoundError(request.organizationId);
    }
    
    // éªŒè¯ç›®æ ‡å€¼åˆç†æ€§
    if (request.value <= 0) {
      throw new InvalidTargetValueError('Target value must be positive');
    }
    
    // éªŒè¯æ—¶é—´èŒƒå›´åˆç†æ€§
    if (request.startDate >= request.endDate) {
      throw new InvalidTimeRangeError('Start date must be before end date');
    }
    
    // éªŒè¯é‡å¤ç›®æ ‡
    const existingTarget = await this.targetRepository.findByUniqueKey(
      request.organizationId,
      request.productId,
      request.year,
      request.quarter,
      request.month
    );
    
    if (existingTarget) {
      throw new DuplicateTargetError('Target already exists for the given criteria');
    }
  }
}
```

---

## ğŸ“‹ ä¸šåŠ¡è§„åˆ™

### ğŸ¯ ç›®æ ‡ç®¡ç†è§„åˆ™

```typescript
// ä¸šåŠ¡è§„åˆ™å¼•æ“
interface BusinessRules {
  // ç›®æ ‡åˆ›å»ºè§„åˆ™
  targetCreation: {
    // è§„åˆ™1: ç›®æ ‡å€¼å¿…é¡»ä¸ºæ­£æ•°
    positiveValue: {
      condition: (target: Target) => target.value > 0;
      errorMessage: 'ç›®æ ‡å€¼å¿…é¡»å¤§äº0';
      severity: 'error';
    };
    
    // è§„åˆ™2: å¹´åº¦ç›®æ ‡å¿…é¡»åœ¨è´¢å¹´å†…
    fiscalYear: {
      condition: (target: Target) => {
        const fiscalStart = new Date(target.year, 3, 1); // 4æœˆ1æ—¥
        const fiscalEnd = new Date(target.year + 1, 2, 31); // æ¬¡å¹´3æœˆ31æ—¥
        return target.startDate >= fiscalStart && target.endDate <= fiscalEnd;
      };
      errorMessage: 'ç›®æ ‡æ—¶é—´å¿…é¡»åœ¨è´¢å¹´èŒƒå›´å†…';
      severity: 'error';
    };
    
    // è§„åˆ™3: å­ç›®æ ‡æ€»å’Œä¸èƒ½è¶…è¿‡çˆ¶ç›®æ ‡
    targetHierarchy: {
      condition: async (target: Target, repository: TargetRepository) => {
        if (target.quarter || target.month) return true; // éé¡¶å±‚ç›®æ ‡
        
        const childTargets = await repository.findByParentId(target.id);
        const childSum = childTargets.reduce((sum, child) => sum + child.value, 0);
        return childSum <= target.value;
      };
      errorMessage: 'å­ç›®æ ‡æ€»å’Œä¸èƒ½è¶…è¿‡çˆ¶ç›®æ ‡';
      severity: 'warning';
    };
  };
  
  // ä¸šç»©éªŒè¯è§„åˆ™
  achievementValidation: {
    // è§„åˆ™1: è¾¾æˆç‡ä¸èƒ½è¶…è¿‡150%
    maxAchievementRate: {
      condition: (achievement: Achievement) => achievement.achievementRate <= 1.5;
      errorMessage: 'è¾¾æˆç‡ä¸èƒ½è¶…è¿‡150%';
      severity: 'warning';
    };
    
    // è§„åˆ™2: è´Ÿå¢é•¿éœ€è¦è¯´æ˜
    negativeGrowth: {
      condition: (achievement: Achievement) => {
        return achievement.actualValue >= achievement.plannedValue * 0.5;
      };
      errorMessage: 'å®é™…å€¼è¿‡ä½ï¼Œéœ€è¦è¯´æ˜åŸå› ';
      severity: 'info';
    };
  };
  
  // æ•°æ®è´¨é‡è§„åˆ™
  dataQuality: {
    // è§„åˆ™1: æ•°æ®å®Œæ•´æ€§æ£€æŸ¥
    completeness: {
      condition: (data: any) => {
        const requiredFields = ['actualValue', 'plannedValue', 'period'];
        return requiredFields.every(field => data[field] != null);
      };
      errorMessage: 'ç¼ºå°‘å¿…è¦å­—æ®µ';
      severity: 'error';
    };
    
    // è§„åˆ™2: æ•°æ®ä¸€è‡´æ€§æ£€æŸ¥
    consistency: {
      condition: (achievement: Achievement, target: Target) => {
        return achievement.organizationId === target.organizationId &&
               achievement.productId === target.productId;
      };
      errorMessage: 'ä¸šç»©æ•°æ®ä¸ç›®æ ‡æ•°æ®ä¸ä¸€è‡´';
      severity: 'error';
    };
  };
}
```

### ğŸ“Š æ•°æ®èšåˆè§„åˆ™

```typescript
// æ•°æ®èšåˆè§„åˆ™å®šä¹‰
interface AggregationRules {
  // æ—¶é—´ç»´åº¦èšåˆ
  timeAggregation: {
    // æœˆåº¦èšåˆåˆ°å­£åº¦
    monthToQuarter: {
      source: 'monthly_data';
      target: 'quarterly_data';
      method: 'sum';
      condition: 'same_year_and_quarter';
    };
    
    // å­£åº¦èšåˆåˆ°å¹´åº¦
    quarterToYear: {
      source: 'quarterly_data';
      target: 'yearly_data';
      method: 'sum';
      condition: 'same_year';
    };
  };
  
  // ç»„ç»‡ç»´åº¦èšåˆ
  organizationAggregation: {
    // ä¸‹çº§æœºæ„èšåˆåˆ°ä¸Šçº§æœºæ„
    childrenToParent: {
      source: 'branch_data';
      target: 'city_data';
      method: 'sum';
      condition: 'direct_parent_child';
    };
    
    // åŸå¸‚èšåˆåˆ°çœä»½
    cityToProvince: {
      source: 'city_data';
      target: 'province_data';
      method: 'sum';
      condition: 'same_province';
    };
  };
  
  // äº§å“ç»´åº¦èšåˆ
  productAggregation: {
    // å­äº§å“èšåˆåˆ°ä¸»äº§å“
    subToMain: {
      source: 'sub_product_data';
      target: 'main_product_data';
      method: 'sum';
      condition: 'same_main_category';
    };
    
    // äº§å“èšåˆåˆ°å“ç±»
    productToCategory: {
      source: 'product_data';
      target: 'category_data';
      method: 'sum';
      condition: 'same_category';
    };
  };
  
  // æ¯”ç‡æŒ‡æ ‡èšåˆ
  ratioAggregation: {
    // è¾¾æˆç‡èšåˆ
    achievementRate: {
      numerator: 'sum_of_actual_values';
      denominator: 'sum_of_planned_values';
      formula: 'numerator / denominator';
      unit: 'percentage';
    };
    
    // å¢é•¿ç‡èšåˆ
    growthRate: {
      numerator: 'current_period_value';
      denominator: 'previous_period_value';
      formula: '(numerator - denominator) / denominator';
      unit: 'percentage';
    };
  };
}
```

---

**æ–‡æ¡£ç‰ˆæœ¬:** 2.0.0  
**æ›´æ–°æ—¶é—´:** 2025-12-23  
**ç»´æŠ¤å›¢é˜Ÿ**: ä¸šåŠ¡æ¶æ„å›¢é˜Ÿ  
**ç›¸å…³æ–‡æ¡£**: [ç³»ç»Ÿæ¶æ„è®¾è®¡](./ç³»ç»Ÿæ¶æ„è®¾è®¡.md) | [æ•°æ®æ¶æ„è®¾è®¡](./æ•°æ®æ¶æ„è®¾è®¡.md)