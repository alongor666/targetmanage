# 2026 目标管理可视化 — 项目开发文档（UI 端结构与构建）

> 口径原则：严格口径（方案 A）。任何不可计算指标必须输出为 null（空）并给出原因，不得用 0 代替。

## 1. 项目定位

### 1.1 目标

本项目用于将 2026 年度目标（机构×产品）按可配置权重拆解为：

- 月度目标、季度目标、年累计目标（YTD）
  并在用户录入实际后自动计算：
- 月/季/年达成率
- 时间进度（线性月份 / 目标权重）与时间进度达成率
- 同比增长率与增量（当月/当季/年累计）——在导入 2025 分月基线后点亮

### 1.2 非目标（V0 不做）

- 不做任何“基线估算”（仅主页面增长率序列允许用年度目标按线性/权重拆月作展示估算，不参与 KPI 口径）
- 不把“同城/异地/全省汇总行”作为输入事实（汇总由系统派生）
- 不引入数据库与账号体系（后续可扩展）

## 2. 核心口径与规则（必须一致）

### 2.1 机构分组

- local（同城）
- remote（异地）
- all（全省，派生汇总）

### 2.2 产品

- auto（车险）
- property（财产险）
- life（人身险）
- total（汇总，派生）

### 2.3 权重

默认统一权重（用户可配置）：

- 1–12 月：10%, 7%, 10%, 10%, 10%, 8%, 6%, 6%, 8%, 8%, 8%, 9%
  季度权重为派生校验：
- Q1=27%、Q2=28%、Q3=20%、Q4=25%

### 2.4 时间进度（双口径）

- 线性月份进度（年度）：t/12
- 权重进度（年度）：sum(w[1..t])
- 线性月份进度（季度）：季内已过月份/3
- 权重进度（季度）：sum(季内已过权重)/sum(季内总权重)

### 2.5 严格口径：增长率与增量

- 当月/当季/年累计增长率与增量：依赖 2025 分月基线
- 若缺基线：输出 null，并标注原因（missing_baseline_monthly_2025）
- 分母为 0：输出 null（division_by_zero）
- 主页面双 Y 轴增长率序列允许估算：当 2026 分月实际缺失时，按年度目标拆月（线性/权重）计算展示增长率

## 3. 数据与文件（无硬编码）

### 3.1 开发期示例数据

位置：`public/data/`

- orgs.json：机构主数据
- targets_annual_2026.json：2026 年度目标（事实）
- actuals_annual_2025.json：2025 年度实际（事实，年度层）
- allocation_rules.json：权重规则
- field_mapping.json：字段中英文对照与中文原始名
- actuals_monthly_2026_template.json：2026 分月实际模板（可导入）

### 3.2 V1 必备导入数据（你后续提供）

2025 分月实际最小字段：

- year（2025）
- month（1..12）
- org_id 或 org_cn
- product（auto/property/life）或 product_cn（车险/财产险/人身险）
- monthly_actual（万元）

## 4. UI 端展示结构（信息架构 IA）

> 原则：先“总览可控”，再“下钻可证”，再“校验可对账”。

### 4.1 路由（App Router）

- `/` 总览（全省/同城/异地 × 产品/汇总）
- `/orgs` 机构列表（支持筛选：同城/异地、目标规模、产品结构）
- `/orgs/[org_id]` 机构详情（产品矩阵 + 月/季拆解 + 实际录入入口）
- `/earned-premium` 已赚保费预测（视角/机构/产品/年度/截至月份/时间进度口径）
- `/rules` 权重配置（版本化、校验、导出）
- `/import` 数据导入（CSV（逗号分隔值）/JSON（JavaScript Object Notation））
- `/qa` 对账校验（目标拆解、汇总、权重、达成一致性）

> V0 已实现：`/`、`/rules`、`/data`（后续可按本结构补齐）

### 4.2 页面模块拆解（页面内区块）

#### A. 总览页（/）

1) 过滤器条（视角：全省/同城/异地；产品：汇总/车险/财产险/人身险；截至月份）
2) KPI 卡片区
   - 年度目标
   - 截至本月目标（YTD target）
   - 年度时间进度（线性/权重可切换）
   - 时间进度达成率（录入实际后点亮）
3) 图表展示顺序：季度图表在前，月度图表在后
   - 季度保费规划图、季度占比规划图
   - 月度保费规划图、月度占比规划图
4) 图表配色与预警功能：
   - **增长率预警阈值**：5%（低于5%触发预警）
   - **预警状态颜色方案**：
     * 柱状图：橙色（#FF9500）
     * 柱状图标签：深红色（#8B0000）
     * 折线图标签：深红色（#8B0000）
     * 折线图线条：深蓝色（#1E40AF，保持不变）
   - **默认状态颜色方案**：
     * 柱状图标签：灰色（#6B7280）
     * 折线图标签：蓝色（#3B82F6）
   - **技术实现**：使用 ECharts `rich` 文本样式实现动态标签颜色
5) 图表 1：月度目标/实际/增长率（双 Y 轴）
   - 右轴增长率固定百分比格式，含 5% 预警线
6) 图表 2：季度目标（四块卡片或柱状）
7) 状态提示区（严格口径：哪些指标等待哪些数据）

#### B. 机构列表（/orgs）

1) 机构表格：年度目标（汇总/分产品）、同城/异地
2) 目标结构：产品占比（小型条形/堆叠）
3) 下钻入口：进入机构详情

#### C. 机构详情（/orgs/[org_id]）

1) 机构概况（年度目标、产品结构）
2) 月度/季度口径切换（可选任意月份/季度）
3) 月度/季度拆解表（含对账：合计回算年度）
4) 实际录入（导入或手动）
5) 同比增长率（随月度/季度口径切换）

#### D. 权重配置（/rules）

1) 12 个月权重编辑
2) 校验：权重和=1（强约束）
3) 导出 JSON（供导入与版本管理）
4) 备注：权重适用范围（全省统一 / 分机构个性化 — V1 扩展）

#### E. 数据导入（/import）

1) 上传 CSV/JSON
2) 映射与预览（机构、产品）
3) 校验结果（错误清单）
4) 写入数据存储（V0：浏览器 localStorage；V1：后端）

#### F. 对账校验（/qa）

- 目标拆解对账：年度=12 月之和；季度=季内 3 月之和
- 汇总对账：全省=同城+异地
- 权重对账：sum=1；12 月累计进度=1
- 达成与进度对账：t=12 时，时间进度达成率应与年累计达成率一致（允许四舍五入误差）

#### G. 已赚保费预测（/earned-premium）

1) 过滤器条（视角/机构/产品/年度/截至月份/时间进度口径）
2) 已赚保费图表
   - 并列柱：当月保费收入 vs 当月已赚保费
   - 车险保费收入：商业险 + 交强险堆积
   - 折线：当月满期率
3) 数据来源优先级：月度实际 > 目标权重拆月 > 2025实际拆月 > 线性拆月
4) 口径提示区：缺少首日费用率/拆分保费时给出提示

## 5. 组件与复用（UI 层）

### 5.1 通用组件

- FilterBar：统一筛选条
- KpiCard：KPI 卡片（支持 hint、状态）
- ChartCard：图表容器（标题、注释、导出）
- DataStatusBadge：数据准备状态（ready / missing / blocked）
- EmptyState：严格口径缺数提示（解释原因与需要的数据）

### 5.2 图表组件（ECharts（可视化图表库））

- MonthlyDualAxis：月度目标（左轴）+ 2025 实际（左轴）+ 增长率（右轴）
- QuarterlyBars：季度目标
- (V1) TargetVsActualTrend：目标 vs 实际双线（点亮后）
- (V1) GrowthWaterfall：增量分解（点亮后）

## 6. 计算引擎（Domain 层纯函数）

### 6.1 输入事实

- 年度目标：annual_target（按机构×产品）
- 月度实际：monthly_actual（按机构×产品×月份）
- 权重：weights[12]

### 6.2 输出派生

- monthly_target = annual_target × w[m]
- quarter_target = sum(月度目标)
- ytd_target = sum(1..t 月度目标)
- 达成率：actual / target（分母 0 输出 null）
- 时间进度达成率（线性/权重）：ytd_actual / expected_cum

### 6.3 严格口径处理

- 缺 2025 分月：增长率相关字段输出 null，并携带 reason

## 7. 数据加载与导入（Service 层）

### 7.1 加载顺序（推荐）

1) orgs.json（机构主数据）
2) allocation_rules.json（权重）
3) targets_annual_2026.json（目标事实）
4) actuals（年度/分月）与用户导入覆盖

### 7.2 导入策略（推荐 V0）

- 解析后写入 localStorage（避免引入后端）
- 页面刷新后仍可恢复
- 允许用户一键清空与回退示例数据

## 8. UI 风格与交互规范（V0）

### 8.1 视觉

- 白底、浅灰分割、卡片圆角
- 颜色克制：状态色仅用于“可算/不可算/告警”
- 数字格式：万元保留 2 位小数；百分比保留 1 位小数

### 8.2 交互

- 所有不可计算字段显示 `—`
- 鼠标悬停（hover）说明：缺什么数据、何时点亮
- 所有汇总行必须标注“系统派生”

## 9. 构建与运行

### 9.1 本地开发

（npm（Node Package Manager））

- npm install
- npm run dev

（pnpm（包管理器））

- pnpm i
- pnpm dev

> 建议：Node.js 使用 20 LTS（长期支持版）以保证工具链稳定。

### 9.2 构建与启动

- npm run build
- npm run start

## 10. 版本推进建议（路线图）

### V0（当前）

- 目标拆解、双口径进度、数据状态、权重可编辑（本地）
- 严格口径：增长率字段保留为空

### V1（你提供 2025 分月 + 2026 分月实际后）

- 达成率点亮
- 增长率与增量点亮
- 机构下钻与 QA 对账页完善
- 导入页完善（映射、预览、错误清单）

### V2（可选）

- 权重版本管理（按年份/按机构/按产品）
- 多人协作与权限（接入后端）

—— 文档到此为止 ——
