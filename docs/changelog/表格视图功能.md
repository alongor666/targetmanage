# 表格视图功能更新

**更新日期**: 2025-12-25
**版本**: v2.2.0
**影响范围**: 通用图表组件

## 📋 更新内容

### 功能变更

将季/月度保费规划图的"增长率"视图模式改为"表格"视图模式：

- **原功能**: 点击"增长率"按钮显示与"占比视图"相同的图表
- **新功能**: 点击"表格"按钮以表格形式展示详细数据

### 用户价值

1. **提供更清晰的数据查看方式**
   - 表格视图可以一次性查看所有数据字段
   - 适合精确数值对比和数据分析

2. **统一视图模式逻辑**
   - 避免重复的图表视图
   - 每种视图模式提供不同的数据展示方式

## 🔄 技术变更

### 类型定义更新

```typescript
// 之前
export type ViewMode = 'proportion' | 'absolute' | 'growth';

// 现在
export type ViewMode = 'proportion' | 'absolute' | 'table';
```

### 新增组件

- `src/components/charts/UniversalChart/components/TableView.tsx`
  - 表格视图组件
  - 支持季度/月度数据展示
  - 自动格式化数值、百分比、增长率
  - 根据预警级别显示状态标签

### 组件更新

1. **ViewSwitcher**
   - 按钮文本: "增长率" → "表格"
   - 图标: 📉 → 📋
   - 描述: "突出增长率" → "以表格形式展示详细数据"

2. **UniversalChart**
   - 新增表格视图渲染逻辑
   - 当 `viewMode === 'table'` 时显示 TableView 组件
   - 其他模式显示 ECharts 图表

3. **useUniversalConfig Hook**
   - 移除 `growth` 模式的配置逻辑
   - 仅保留图表视图模式的配置

### 测试更新

- `src/app/test/quarterly-chart/page.tsx`
  - 测试按钮从"增长率"改为"表格"

## 📊 表格视图功能

### 显示字段

| 字段 | 说明 | 格式化 |
|------|------|--------|
| 季度/月份 | 时间周期 | 文本 |
| 2026目标 | 目标值 | 千分位数值 |
| 目标占比 | 目标占总目标百分比 | 百分比 |
| 2025实际 | 2025年同期实际值 | 千分位数值 |
| 2025占比 | 2025实际占总实际百分比 | 百分比 |
| 当前实际 | 当前实际值 | 千分位数值 |
| 增长率 | 同比增长率 | 百分比（带颜色） |
| 状态 | 预警级别 | 徽章 |

### 增长率颜色编码

- **绿色** (#4caf50): 增长率 ≥ 12%
- **蓝色** (#3B82F6): 5% ≤ 增长率 < 12%
- **橙色** (#FF9500): 0% ≤ 增长率 < 5%
- **红色** (#DC2626): 增长率 < 0%
- **灰色** (#9CA3AF): 无数据（null）

### 状态徽章

- **优秀**: 绿色徽章（增长率 ≥ 12%）
- **正常**: 蓝色徽章（5% ≤ 增长率 < 12%）
- **预警**: 橙色徽章（0% ≤ 增长率 < 5%）
- **危险**: 红色徽章（增长率 < 0%）

## 📝 文档更新

### 已更新文档

1. `docs/通用图表组件复用方案.md`
   - ViewMode 类型定义
   - 交互增强说明
   - 功能验收标准

2. 组件代码文档
   - `src/components/charts/UniversalChart/UniversalChart.types.ts`
   - `src/components/charts/UniversalChart/components/TableView.tsx`
   - `src/components/charts/QuarterlyProportionChart/QuarterlyProportionChart.types.ts`
   - `src/components/charts/QuarterlyProportionChart/components/ViewSwitcher.tsx`

### 相关文档

- `docs/development/开发指南.md` - UI开发规范
- `docs/design/全局设计规范.md` - 颜色系统
- `docs/reference/术语词典.md` - 术语定义

## ✅ 测试验证

### 功能测试

- [x] 表格视图正确显示所有字段
- [x] 数值格式化正确（千分位、百分比）
- [x] 增长率颜色编码正确
- [x] 状态徽章显示正确
- [x] 视图模式切换流畅
- [x] 季度/月度数据都支持
- [x] 响应式布局正常
- [x] 空值（null）显示为 "—"

### 兼容性测试

- [x] TypeScript 类型检查通过
- [x] 现有图表功能不受影响
- [x] 详情面板交互正常
- [x] 导出功能正常（占比/绝对值视图）

## 🚀 使用示例

```tsx
import { UniversalChart } from '@/components/charts/UniversalChart';

// 数据适配
const adaptedData = createQuarterlyPremiumAdapter().adapt(quarterlyPremiumData);

// 渲染图表（支持3种视图模式）
<UniversalChart
  chartType="quarterlyPremium"
  data={adaptedData}
  config={{
    title: '季度保费规划图',
    height: 360,
  }}
/>
```

用户可以通过点击右上角的按钮切换视图：
- 📊 **占比视图**: 显示百分比占比柱状图
- 📈 **绝对值**: 显示实际数值柱状图
- 📋 **表格**: 以表格形式展示详细数据

## 📈 后续优化

### 潜在改进方向

1. **表格排序**
   - 支持点击列头排序
   - 多列组合排序

2. **数据筛选**
   - 按状态徽章筛选
   - 按数值范围筛选

3. **导出功能**
   - 导出表格为 CSV
   - 导出表格为 Excel

4. **分页显示**
   - 对于大量数据的场景
   - 可配置每页行数

## 📞 相关链接

- 功能讨论: [Issue #XXX]
- 设计稿: [Figma Link]
- 测试页面: `/test/quarterly-chart`

---

**维护者**: 开发团队
**最后更新**: 2025-12-25
