# 指标字典与计算口径（V0）

> 说明：增长率（当月/当季/年累计）在导入 2025 分月基线后自动点亮；当前采用“严格口径”，不可算字段输出为 null。

## 维度
- 年度：year
- 月份：month（1..12）
- 季度：quarter（Q1..Q4）
- 机构：org_id（唯一主键）/ org_cn（原始中文名）
- 分组：group（local=同城，remote=异地，all=全省）
- 产品：product（auto/property/life/health/total）

## 核心派生指标（按 机构×产品×月份/季度/累计）
- monthly_target：月度目标（万元）
- quarter_target：季度目标（万元）
- ytd_target：年累计目标（万元）

- monthly_actual：月度实际（万元）
- quarter_actual：季度实际（万元）
- ytd_actual：年累计实际（万元）

- achievement_rate_month：月达成率 = monthly_actual / monthly_target
- achievement_rate_quarter：季度累计达成率 = quarter_actual / quarter_target
- achievement_rate_ytd：年累计达成率 = ytd_actual / ytd_target

## 时间进度与时间进度达成率（三口径）

### 年度进度计算
- **time_progress_linear_year**：年度线性进度 = 当前月份 / 12
- **time_progress_weighted_year**：年度权重进度 = sum(权重[1..当前月份])
- **time_progress_actual2025_year**：年度2025实际进度 = sum(2025实际[1..当前月份]) / sum(2025实际[1..12])

### 季度进度计算
- **time_progress_linear_quarter**：季度线性进度 = (当前月份 - 季度开始月 + 1) / 3
- **time_progress_weighted_quarter**：季度权重进度 = sum(权重[季度开始..当前月份]) / sum(权重[季度开始..季度结束])
- **time_progress_actual2025_quarter**：季度2025实际进度 = sum(2025实际[季度开始..当前月份]) / sum(2025实际[季度开始..季度结束])

### 应完成累计计算
- **expected_cum_linear_year**：年度线性应完成累计 = 年度目标 × time_progress_linear_year
- **expected_cum_weighted_year**：年度权重应完成累计 = 年度目标 × time_progress_weighted_year
- **expected_cum_actual2025_year**：年度2025实际应完成累计 = 年度目标 × time_progress_actual2025_year
- **expected_cum_linear_quarter**：季度线性应完成累计 = 季度目标 × time_progress_linear_quarter
- **expected_cum_weighted_quarter**：季度权重应完成累计 = 季度目标 × time_progress_weighted_quarter
- **expected_cum_actual2025_quarter**：季度2025实际应完成累计 = 季度目标 × time_progress_actual2025_quarter

### 时间进度达成率计算
- **time_achievement_rate_linear_year**：年度线性时间进度达成率 = YTD实际 / expected_cum_linear_year
- **time_achievement_rate_weighted_year**：年度权重时间进度达成率 = YTD实际 / expected_cum_weighted_year
- **time_achievement_rate_actual2025_year**：年度2025实际时间进度达成率 = YTD实际 / expected_cum_actual2025_year
- **time_achievement_rate_linear_quarter**：季度线性时间进度达成率 = QTD实际 / expected_cum_linear_quarter
- **time_achievement_rate_weighted_quarter**：季度权重时间进度达成率 = QTD实际 / expected_cum_weighted_quarter
- **time_achievement_rate_actual2025_quarter**：季度2025实际时间进度达成率 = QTD实际 / expected_cum_actual2025_quarter

### 默认权重配置
- **月度权重**：[7.0%, 7.3%, 9.2%, 8.8%, 9.4%, 9.9%, 6.6%, 6.6%, 6.8%, 8.3%, 8.3%, 11.8%]
- **季度权重**：Q1=27%, Q2=28%, Q3=20%, Q4=25%（由月度权重派生）

### 口径说明
- **线性口径**：假设每月贡献均等（1/12），适合无历史数据或业务均匀分布的场景
- **权重口径**：使用预配置的月度权重，反映业务季节性特征，适合有明确目标分配策略的场景
- **2025实际口径**：使用2025年实际数据的分布，反映真实的业务节奏，适合有完整历史数据且业务模式稳定的场景
  - 要求：需导入完整的2025年月度实际数据
  - 优势：最贴近实际业务节奏，时间进度达成率更具参考价值
  - 计算逻辑：将2025年各月实际值作为权重分布，计算当前月份应占的累计比例

## 同比增长与增量（6字段严格口径）

### 增长率字段（同比）
- **growth_month_rate**：当月同比增长率 = (当期值 - 基期值) / 基期值
- **growth_quarter_rate**：当季同比增长率 = (当季累计 - 基期同季) / 基期同季  
- **growth_ytd_rate**：年累计同比增长率 = (年累计 - 基期同周期) / 基期同周期

### 增量字段（绝对差值）
- **inc_month**：当月增量（万元）= 当期值 - 基期值
- **inc_quarter**：当季增量（万元）= 当季累计 - 基期同季
- **inc_ytd**：年累计增量（万元）= 年累计 - 基期同周期

### 增长率序列（主页面双 Y 轴展示）
- 2026 分月实际存在时，使用分月实际计算增长率序列
- 2026 分月实际缺失时，使用年度目标按线性/权重拆月的估算值计算增长率序列
- 线性/权重拆月方式与页面“时间进度口径”联动
- 2025 分月实际缺失或分母为 0 时，该月份增长率返回 null（UI 显示“—”）

### 计算示例
假设 2025年1月车险实际 1000万，2026年1月车险实际 1200万：
- growth_month_rate = (1200 - 1000) / 1000 = 0.2 (20.0%)
- inc_month = 1200 - 1000 = 200万

### Null安全策略
- **分母为0**：返回 null，UI显示"—"，reason 字段记录 "division_by_zero"
- **无基期数据**：返回 null，UI显示"—"，reason 字段记录 "no_baseline_data"

## 增长率预警规则（可视化展示）

### 预警阈值
- **5%阈值**：当增长率低于5%时触发预警状态
- **适用图表**：月度保费规划图、季度保费规划图、月度占比规划图、季度占比规划图

### 预警状态配色
| 元素 | 默认状态 | 预警状态（< 5%） |
|------|---------|-----------------|
| 柱状图 | 浅蓝色/浅灰色 | 橙色（#FF9500） |
| 柱状图标签 | 灰色（#6B7280） | 深红色（#8B0000） |
| 折线图标签 | 蓝色（#3B82F6） | 深红色（#8B0000） |
| 折线图线条 | 深蓝色（#1E40AF） | 深蓝色（#1E40AF，保持不变） |

### 技术实现
- 使用 ECharts `rich` 文本样式实现动态标签颜色
- 通过 `formatter` 函数判断增长率值，返回带样式标记的字符串
- 示例：`{warning|4.8%}` 或 `{normal|8.5%}`
